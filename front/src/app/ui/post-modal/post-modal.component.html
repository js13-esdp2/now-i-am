<div mat-dialog-content
     fxLayout="column"
     fxLayoutAlign="center"
     class="post-block"
     *ngIf="post | async"
>
  <button type="button"
          class="post-block__close"
          (click)="onClose()"
  >
    <mat-icon class="post-block__close__icon">close</mat-icon>
  </button>

  <div *ngIf="profileIsOpen else profile">
    <img [src]="apiUrl + '/uploads/' + postData.content" [alt]="postData.title" class="post-block__image"/>
    <mat-card-header>
      <mat-card-title>{{ postData.title }}</mat-card-title>
      <div class="placement">
      <div class="heart {{ like }}" (click)="likePost()">
      </div>
    </div>
    </mat-card-header>
    <mat-card-actions *appUserType="'user' else anonLink" class="btn-actions">
      <button
         title="Показать на карте"
         class="btns"
      >
        <mat-icon>location_on</mat-icon>
      </button>
      <button type="button"
              class="btns"
              (click)="goToProfile(postData.title, postData.user._id)"
      >Профиль
      </button>
      <button type="button"
              class="btns"
              *ngIf="userData?.role === 'moderator'"
              (click)="removePost(postData._id)"
      >
        <app-loader [isLoading]="postLoading | async">
          <mat-icon>delete</mat-icon>
        </app-loader>
      </button>
      <button type="button"
              class="btns"
              (click)="showComments()">
        <mat-icon>3p</mat-icon>
      </button>
    </mat-card-actions>
    <div
      *ngIf=" postData.likes.length !== 0"
      class="post-block__likes"
      (click)="openLikesDialog(postData)">
      Понравилось {{ postData.likes[0].user.displayName }} и другим
    </div>
    <mat-card-content class="comments-block" *ngIf="(commentsShow)">
      <div *ngFor="let comment of postData?.comments" class="comments-block__comment">
        <b class="comments-block__userName">{{ comment.user.displayName }}</b>
        <p class="comments-block__text">: {{ comment.text }}</p>
        <button class="comments-block__btn" (click)="removeComment(comment._id)" mat-button><mat-icon class="comments-block__btn-icon">delete</mat-icon></button>
      </div>
      <div class="comments-block__write-comment">
        <mat-form-field appearance="fill" style="width: 100%">
          <mat-label>Добавить комментарий</mat-label>
          <input matInput name="comment" [(ngModel)]=comment>
        </mat-form-field>
        <button type="button" mat-button  (click)="createComment()">опубликовать</button>
      </div>
      </mat-card-content>
  </div>

  <ng-template #anonLink>
    <a class="post-block__link">
      Хотите поговорить с {{ postData.user.displayName }}? Тогда пройдите регистрацию
    </a>
    <button
      id="dialog-register-button"
      mat-raised-button
      routerLink="/register"
      class="btns"
      (click)="goToRegister()"
    >Регистрация
    </button>
    <button
      class="btns"
      id="dialog-login-button"
      mat-raised-button
      routerLink="/login"
      (click)="goToLogin()"
    >Вход
    </button>
  </ng-template>

  <ng-template #profile>
    <div class="profile" *ngIf="userData">
      <div class="photo-block">
        <img *ngIf="userData.photo" class="photo" [src]="apiUrl + '/uploads/' + userData.photo"
             [alt]="userData.displayName">
        <img *ngIf="!userData.photo" class="photo" src="./assets/images/pipe-image.jpg" [alt]="userData.displayName">
      </div>
      <mat-card-content>
        <h2 class="title" mat-dialog-title>Имя: {{ userData.displayName }}</h2>
        <div *ngIf="!userData.isPrivate">
          <p>
            <strong>О себе: </strong>{{ userData.aboutMe || 'Не указано' }}
          </p>
          <p>
            <strong>Возраст: </strong>{{ userData.age || 'Не указано' }}
          </p>
          <p>
            <strong>Пол: </strong>{{ userData.sex === 'male' ? 'Муж.' : userData.sex === 'female' ? 'Жен.' : 'Не указано' }}
          </p>
          <p>
            <strong>Страна: </strong>{{ userData.country || 'Не указано' }}
          </p>
          <p>
            <strong>Город: </strong>{{ userData.city || 'Не указано' }}
          </p>
          <div class="btn-group">
            <button type="button"
                    class="btns"
                    title="Добавить в друзья"
                    [disabled]="checkUserFriend() || (addFriendLoading | async)"
                    (click)="addFriend()"
            >
              <app-loader [isLoading]="addFriendLoading | async">
                <mat-icon>person_add_alt</mat-icon>
              </app-loader>
            </button>
            <button type="button"
                    class="btns"
                    (click)="goToChat()"><mat-icon>forum</mat-icon>
            </button>
          </div>
        </div>
      </mat-card-content>
      <button class="button-exit" color="primary" (click)="closeProfile()">
        <mat-icon class="post-block__close__icon">reply</mat-icon>
      </button>
    </div>
  </ng-template>
</div>

