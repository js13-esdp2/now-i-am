<app-centered-card title="Поиск">
  <form (ngSubmit)="onSubmit()"
        #f="ngForm"
        class="form"
  >
    <mat-form-field appearance="outline" class="form__searchInput">
      <mat-label>Название поста</mat-label>
      <input type="text"
             name="title"
             matInput
             required
             ngModel
             #title="ngModel"
      />
      <mat-error *ngIf="title.touched && title.hasError('required')">
        Поле обязательное для ввода
      </mat-error>
    </mat-form-field>

    <mat-accordion class="filter-block">
      <mat-expansion-panel
        (opened)="panelOpenState = true"
        (closed)="panelOpenState = false">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Расширенный поиск
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="filter-block__slider">
          <mat-slider min="5" max="90" step="1" value="5" thumbLabel ngModel name="birthday"></mat-slider>
          <span>Укажите возраст</span>
        </div>

        <mat-form-field appearance="outline" class="filter-block__sex">
          <mat-label>Пол</mat-label>
          <mat-select name="sex" ngModel>
            <mat-option value="male">Мужской</mat-option>
            <mat-option value="female">Женский</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-block__country">
          <mat-label>Страна</mat-label>
          <mat-select name="country" ngModel>
            <mat-option
              *ngFor="let c of country | async" [value]="c.name.official"
              (click)="onSplitCapitalToCountry(c.name.official)"
            >{{ c.name.official }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-block__city">
          <mat-label>Город</mat-label>
          <mat-select name="city" ngModel [disabled]="town">
            <mat-option *ngFor="let c of city" [value]="c">{{ c }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-block__isPrivate">
          <mat-label>Приватность</mat-label>
          <mat-select name="isPrivate" ngModel>
            <mat-option value="true">Приватный</mat-option>
            <mat-option value="false">Открытый</mat-option>
          </mat-select>
        </mat-form-field>

      </mat-expansion-panel>
    </mat-accordion>

    <div>
      <button mat-raised-button
              class="form__searchBtn"
              type="submit"
              [disabled]="f.invalid || (isLoading | async)"
      >
        <app-loader [isLoading]="isLoading | async" class="form__search-slider" size="sm">
          <span class="material-icons form__search-icon">search</span>
        </app-loader>
      </button>
    </div>
  </form>
</app-centered-card>

<div class="search-users-block">
  <mat-card *ngIf="isSearched && (posts | async) as $posts"
            class="search-users-block__search-card-wrapper"
  >
    <mat-card-content>
      <div class="amount-user">
        <p class="amount-user__title-number">{{ $posts.length }}</p>
        <h3 class="amount-user__title">Количество найденных постов</h3>
      </div>
      <div class="search-users" *ngFor="let post of $posts">
        <mat-card class="search-users__search-user-card"
                  (click)="openPost(post)"
        >{{ post.user.displayName }}</mat-card>
      </div>
    </mat-card-content>
  </mat-card>
</div>
